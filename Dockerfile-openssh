FROM alpine
RUN apk add --no-cache openssh shadow

RUN sed -i "s/#Port 22/Port 22/g; \
            s/#PasswordAuthentication yes/PasswordAuthentication no/g; \
            s/#ChallengeResponseAuthentication yes/ChallengeResponseAuthentication no/g; \
            s/AllowTcpForwarding no/AllowTcpForwarding yes/g; \
            s/GatewayPorts no/GatewayPorts yes/g" /etc/ssh/sshd_config && \
    usermod -p '' root && \
    mkdir /root/.ssh && \
    chmod 0700 /root/.ssh \
    rm -rf /var/cache/apk/*

EXPOSE 22

CMD ["/usr/sbin/sshd", "-D", "-e", "-f", "/etc/ssh/sshd_config"]
